name: "csfb-topology"

config:
  topology.workers: 30
  project.spout.type: kafka
  project.spout.file.topics: ["lte_s1_mme", "lte_sgs", "mc_call", "mc_paging", "mc_location"]

  project.spout.ftp.reader.threads: 10
  project.spout.kafka.reader.threads: 128
  project.spout.redis.reader.threads: 10
#  the redis scan delay this time
  project.spout.redis.buffer.ms: 3600000
  project.spout.parallelism: 10
  project.spout.zk.connect: "10.221.247.11:2181/partition-manager"
  project.redis.partition.size: 50000
  project.bolt.parallelism: 10
# MQ conf
  project.mq.broker.url: "tcp://10.221.247.50:61616"
  project.mq.queue.name: "Q_EVENT_PMCA_FILE2"

  topology.worker.childopts: "-server -Xms1g -Xmx4g -Xmn2g -XX:ParallelGCThreads=10"
  topology.fall.back.on.java.serialization: false
  topology.skip.missing.kryo.registrations: false
  topology.acker.executors: 0
  topology.executor.send.buffer.size: 2048
  topology.executor.receive.buffer.size: 2048
  topology.receiver.buffer.size: 64
  topology.transfer.buffer.size: 8192
  storm.messaging.netty.sync.mode: false
  topology.buffer.size.limited: false

  topology.backpressure.enable: true
  backpressure.disruptor.high.watermark: 0.9
  backpressure.disruptor.low.watermark:  0.4


  csvparser.selector.class: com.eastcom.csfb.storm.base.TopicCSVParsers

#  worker.childopts: "-Xmx3g"
  topology.metrics.consumer.register:
    - class: "org.apache.storm.metric.LoggingMetricsConsumer"
      parallelism.hint: 1

# kafka conf
  kafka.group.id: csfb_topology
  kafka.topic.names: ["r_lte_s1_mme", "r_lte_sgs", "r_mc_call", "r_mc_paging", "r_mc_location"]
  kafka.bootstrap.servers: "10.11.94.54:6667,10.11.94.62:6667,10.11.94.70:6667,10.11.94.77:6667,10.11.94.177:6667,10.11.94.179:6667,10.11.94.183:6667,10.11.94.185:6667,10.11.94.186:6667,10.11.94.190:6667,10.11.94.192:6667,10.11.94.107:6667,10.11.94.100:6667,10.11.94.92:6667,10.11.94.84:6667,10.11.94.156:6667"
  kafka.key.deserializer: org.apache.kafka.common.serialization.ByteArrayDeserializer
  kafka.value.deserializer: org.apache.kafka.common.serialization.ByteArrayDeserializer
  kafka.auto.offset.reset: latest

#includes:
#  - resource: false
#    file: "../flux/redisPool.yaml"
#    override: false
  pubsub.jedis.address: 10.221.247.8:9000
  pubsub.jedis.password: stream!23$

  pubsub.jedis.address: 10.11.94.160:6301
  pubsub.jedis.password: stream!23$

  jedis.minIdle: 4
  jedis.maxIdle: 4
  jedis.maxTotal: 4
  jedis.testOnBorrow: false
  jedis.password: stream!23$
  jedis.addresses:
    - 10.11.94.155:6401
    - 10.11.94.155:6402
    - 10.11.94.155:6403
    - 10.11.94.155:6404
    - 10.11.94.155:6405
    - 10.11.94.155:6406
    - 10.11.94.155:6407
    - 10.11.94.155:6408
    - 10.11.94.155:6409
    - 10.11.94.160:6401
    - 10.11.94.160:6402
    - 10.11.94.160:6403
    - 10.11.94.160:6404
    - 10.11.94.160:6405
    - 10.11.94.160:6406
    - 10.11.94.160:6407
    - 10.11.94.160:6408
    - 10.11.94.160:6409
    - 10.11.94.161:6401
    - 10.11.94.161:6402
    - 10.11.94.161:6403
    - 10.11.94.161:6404
    - 10.11.94.161:6405
    - 10.11.94.161:6406
    - 10.11.94.161:6407
    - 10.11.94.161:6408
    - 10.11.94.161:6409
    - 10.11.94.162:6401
    - 10.11.94.162:6402
    - 10.11.94.162:6403
    - 10.11.94.162:6404
    - 10.11.94.162:6405
    - 10.11.94.162:6406
    - 10.11.94.162:6407
    - 10.11.94.162:6408
    - 10.11.94.162:6409
    - 10.11.94.163:6401
    - 10.11.94.163:6402
    - 10.11.94.163:6403
    - 10.11.94.163:6404
    - 10.11.94.163:6405
    - 10.11.94.163:6406
    - 10.11.94.163:6407
    - 10.11.94.163:6408
    - 10.11.94.163:6409
    - 10.11.94.167:6401
    - 10.11.94.167:6402
    - 10.11.94.167:6403
    - 10.11.94.167:6404
    - 10.11.94.167:6405
    - 10.11.94.167:6406
    - 10.11.94.167:6407
    - 10.11.94.167:6408
    - 10.11.94.167:6409
    - 10.11.94.168:6401
    - 10.11.94.168:6402
    - 10.11.94.168:6403
    - 10.11.94.168:6404
    - 10.11.94.168:6405
    - 10.11.94.168:6406
    - 10.11.94.168:6407
    - 10.11.94.168:6408
    - 10.11.94.168:6409
    - 10.11.94.169:6401
    - 10.11.94.169:6402
    - 10.11.94.169:6403
    - 10.11.94.169:6404
    - 10.11.94.169:6405
    - 10.11.94.169:6406
    - 10.11.94.169:6407
    - 10.11.94.169:6408
    - 10.11.94.169:6409
    - 10.11.94.170:6401
    - 10.11.94.170:6402
    - 10.11.94.170:6403
    - 10.11.94.170:6404
    - 10.11.94.170:6405
    - 10.11.94.170:6406
    - 10.11.94.170:6407
    - 10.11.94.170:6408
    - 10.11.94.170:6409
    - 10.11.94.171:6401
    - 10.11.94.171:6402
    - 10.11.94.171:6403
    - 10.11.94.171:6404
    - 10.11.94.171:6405
    - 10.11.94.171:6406
    - 10.11.94.171:6407
    - 10.11.94.171:6408
    - 10.11.94.171:6409
    - 10.11.94.175:6401
    - 10.11.94.175:6402
    - 10.11.94.175:6403
    - 10.11.94.175:6404
    - 10.11.94.175:6405
    - 10.11.94.175:6406
    - 10.11.94.175:6407
    - 10.11.94.175:6408
    - 10.11.94.175:6409
    - 10.11.94.175:6410
    - 10.11.94.175:6411
    - 10.11.94.175:6412
    - 10.11.94.176:6401
    - 10.11.94.176:6402
    - 10.11.94.176:6403
    - 10.11.94.176:6404
    - 10.11.94.176:6405
    - 10.11.94.176:6406
    - 10.11.94.204:6401
    - 10.11.94.204:6402
    - 10.11.94.204:6403
    - 10.11.94.204:6404
    - 10.11.94.204:6405
    - 10.11.94.204:6406
    - 10.11.94.204:6407
    - 10.11.94.204:6408
    - 10.11.94.204:6409
    - 10.11.94.204:6410
    - 10.11.94.204:6411
    - 10.11.94.204:6412
    - 10.11.94.205:6401
    - 10.11.94.205:6402
    - 10.11.94.205:6403
    - 10.11.94.205:6404
    - 10.11.94.205:6405
    - 10.11.94.205:6406
    - 10.11.94.205:6407
    - 10.11.94.205:6408
    - 10.11.94.205:6409
    - 10.11.94.205:6410
    - 10.11.94.205:6411
    - 10.11.94.205:6412
    - 10.11.94.206:6401
    - 10.11.94.206:6402
    - 10.11.94.206:6403
    - 10.11.94.206:6404
    - 10.11.94.206:6405
    - 10.11.94.206:6406
    - 10.11.94.206:6407
    - 10.11.94.206:6408
    - 10.11.94.206:6409
    - 10.11.94.206:6410
    - 10.11.94.206:6411
    - 10.11.94.206:6412
    - 10.11.94.207:6401
    - 10.11.94.207:6402
    - 10.11.94.207:6403
    - 10.11.94.207:6404
    - 10.11.94.207:6405
    - 10.11.94.207:6406
    - 10.11.94.207:6407
    - 10.11.94.207:6408
    - 10.11.94.207:6409
    - 10.11.94.207:6410
    - 10.11.94.207:6411
    - 10.11.94.207:6412
    - 10.11.94.208:6401
    - 10.11.94.208:6402
    - 10.11.94.208:6403
    - 10.11.94.208:6404
    - 10.11.94.208:6405
    - 10.11.94.208:6406
    - 10.11.94.208:6407
    - 10.11.94.208:6408
    - 10.11.94.208:6409
    - 10.11.94.208:6410
    - 10.11.94.208:6411
    - 10.11.94.208:6412
    - 10.11.94.209:6401
    - 10.11.94.209:6402
    - 10.11.94.209:6403
    - 10.11.94.209:6404
    - 10.11.94.209:6405
    - 10.11.94.209:6406
    - 10.11.94.209:6407
    - 10.11.94.209:6408
    - 10.11.94.209:6409
    - 10.11.94.209:6410
    - 10.11.94.209:6411
    - 10.11.94.209:6412
    - 10.11.94.210:6401
    - 10.11.94.210:6402
    - 10.11.94.210:6403
    - 10.11.94.210:6404
    - 10.11.94.210:6405
    - 10.11.94.210:6406
    - 10.11.94.210:6407
    - 10.11.94.210:6408
    - 10.11.94.210:6409
    - 10.11.94.210:6410
    - 10.11.94.210:6411
    - 10.11.94.210:6412
    - 10.11.94.211:6401
    - 10.11.94.211:6402
    - 10.11.94.211:6403
    - 10.11.94.211:6404
    - 10.11.94.211:6405
    - 10.11.94.211:6406
    - 10.11.94.211:6407
    - 10.11.94.211:6408
    - 10.11.94.211:6409
    - 10.11.94.211:6410
    - 10.11.94.211:6411
    - 10.11.94.211:6412
    - 10.11.94.212:6401
    - 10.11.94.212:6402
    - 10.11.94.212:6403
    - 10.11.94.212:6404
    - 10.11.94.212:6405
    - 10.11.94.212:6406
    - 10.11.94.212:6407
    - 10.11.94.212:6408
    - 10.11.94.212:6409
    - 10.11.94.212:6410
    - 10.11.94.212:6411
    - 10.11.94.212:6412
    - 10.11.94.213:6401
    - 10.11.94.213:6402
    - 10.11.94.213:6403
    - 10.11.94.213:6404
    - 10.11.94.213:6405
    - 10.11.94.213:6406
    - 10.11.94.213:6407
    - 10.11.94.213:6408
    - 10.11.94.213:6409
    - 10.11.94.213:6410
    - 10.11.94.213:6411
    - 10.11.94.213:6412

#  - resource: false
#    file: "../flux/serializer.yaml"
#    override: false
  topology.kryo.register:
     - com.eastcom.csfb.LteS1Mme: com.eastcom.csfb.LteS1MmeSerializer
     - com.eastcom.csfb.LteSGs: com.eastcom.csfb.LteSgsSerializer
     - com.eastcom.csfb.McCallEvent: com.eastcom.csfb.McCallSerializer
     - com.eastcom.csfb.McLocationUpdate: com.eastcom.csfb.McLocationUpdateSerializer
     - com.eastcom.csfb.McPaging: com.eastcom.csfb.McPagingSerializer
     #- java.util.LinkedHashMap: com.eastcom.csfb.storm.base.common.LinkedHashMapSerializer
     - java.util.LinkedHashMap: com.esotericsoftware.kryo.serializers.MapSerializer

#  - resource: false
#    file: "../flux/hdfs-conf.yaml"
#    override: false
  hdfs.url: "hdfs://hdp"
  hdfs.path: "/rawdata/xdr/lte/lte_csfb/"
  hdfs.batch: 100000
  hdfs.createDir.interval: 5
  hdfs.file.content.split: |
  hdfs.file.name.prefix: csfb_


#topologySource:
#    className: "com.eastcom.csfb.storm.topo.CsfbTopology"
#    methodName: "getCsfbTopology"

# spout definitions
spouts:
  - id: "csfbSpout"
    className: "com.eastcom.csfb.storm.topo.CsfbSpout"
    parallelism: 10

# bolt definitions
bolts:
  - id: "extractSignalBolt"
    className: "com.eastcom.csfb.storm.topo.ExtractSignalBolt"
    parallelism: 10
  - id: "outputDataBolt"
    className: "com.eastcom.csfb.storm.topo.OutputDataBolt"
    parallelism: 10

#stream definitions
streams:
  - name: "csfbSpout --> extractSignalBolt"
    from: "csfbSpout"
    to: "extractSignalBolt"
    grouping:
      type: FIELDS
      args: ["partition"]

  - name: "extractSignalBolt --> outputDataBolt"
    from: "extractSignalBolt"
    to: "outputDataBolt"
    grouping:
      type: SHUFFLE
